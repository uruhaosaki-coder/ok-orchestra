<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- タイトルをひらがなに変更 -->
    <title>いろんな楽器の音色を聞いてみよう！</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            scroll-behavior: smooth;
        }
        
        /* 選択中のボタンスタイル (通常のCSS) */
        .track-button.selected {
            /* アイコン版では、枠線を黄色にする */
            border: 4px solid #D3C34A; /* 黄色 */
            background-color: #e0e7ff; /* 少し濃い白 (indigo-50) */
        }
    </style>
</head>
<!-- 背景を #717071 (グレー) に変更 -->
<body class="bg-[#717071] flex items-center justify-center min-h-screen p-4">

    <!-- カードの背景色を #1B2A5C (濃い青) に変更 -->
    <div class="w-full max-w-3xl bg-[#1B2A5C] rounded-lg shadow-xl p-6">
        
        <!-- タイトル「①まずは がっき を えらんでみよう！」 (サイズをh2と合わせる) -->
        <h1 class="text-xl font-bold text-center text-[#D3C34A] mb-4">
            ①まずは がっき を えらんでみよう！
        </h1>

        <!-- トラック選択ボタン (12個用、6列) -->
        <div id="button-container" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-3 mb-4 w-full">
            <template id="track-button-template">
                <!-- Trackボタン: 白背景(bg-white)。文字スタイルを削除し、画像用のスタイル(flex)を追加 -->
                <button class="track-button font-bold py-3 px-2 rounded-lg bg-white hover:bg-gray-100 transition-all duration-200 shadow-md border-4 border-transparent flex items-center justify-center aspect-square">
                    <!-- この中身(innerHTML)はJavaScriptによって <img ...> に置き換えられます -->
                </button>
            </template>
        </div>

        <!-- 案内文 (②) を追加 -->
        <h2 class="text-xl font-bold text-center text-[#D3C34A] mb-6">
            ②さいせいボタン を おして、きいてみよう！
        </h2>

        <!-- 操作ボタン -->
        <div class="flex space-x-4">
            <!-- さいせいボタンの色とテキストを変更 -->
            <button id="play-button" class="flex-1 bg-[#9AB700] hover:bg-opacity-80 text-white font-bold py-4 px-6 rounded-lg text-lg shadow-lg transition duration-300">
                さいせい
            </button>
            <!-- とめるボタンの色とテキストを変更 -->
            <button id="stop-button" class="flex-1 bg-[#AC220D] hover:bg-opacity-80 text-white font-bold py-4 px-6 rounded-lg text-lg shadow-lg transition duration-300">
                とめる
            </button>
        </div>

        <!-- ステータス表示 (明るいグレー) -->
        <div id="status" class="text-center text-gray-300 mt-4 h-6"></div>
    </div>

    <script>
        // --- ▼ 音源・楽器名・アイコン設定 (オーケストラ版) ▼ ---
        
        // !【重要】このファイルは GitHub Pages にアップロードするためのものです。
        // ! このまま「プレビュー」しても "ファイルが見つからない" (音声/画像) エラーになります。
        
        // ▼ 楽器名 (12種類) ▼
        const TRACK_NAMES = [
            "ヴァイオリン", "ヴィオラ", "チェロ", "コントラバス",
            "クラリネット", "フルート", "オーボエ", "ファゴット",
            "トランペット", "トロンボーン", "ホルン", "チューバ"
        ];
        
        // ▼ 楽器アイコンのファイル名 (12種類) ▼
        // ! GitHubに index.html と同じ場所に、この名前の画像ファイルをアップロードしてください。
        const TRACK_ICONS = [
            "tanq_music_Vio.svg", "tanq_music_Via.svg", "tanq_music_Cel.svg", "tanq_music_StB.svg",
            "tanq_music_Cl.svg", "tanq_music_Fl.svg", "tanq_music_Ob.svg", "tanq_music_Fg.svg",
            "tanq_music_Tp.svg", "tanq_music_Tb.svg", "tanq_music_Hr.svg", "tuba.svg"
        ];

        // ▼ 音源ファイル名 (12種類) - .mp3 形式 ▼
        const TRACK_URLS = [
            "wide_25-11_music_2-15a_orchestra_Violin.mp3", // ヴァイオリン
            "wide_25-11_music_2-15b_orchestra_Viola.mp3", // ヴィオラ
            "wide_25-11_music_2-15c_orchestra_Cello.mp3", // チェロ
            "wide_25-11_music_2-15d_orchestra_Contrabass.mp3", // コントラバス
            "wide_25-11_music_2-15e_orchestra_Clarinet.mp3", // クラリネット
            "wide_25-11_music_2-15f_orchestra_Flute.mp3", // フルート
            "wide_25-11_music_2-15g_orchestra_Oboe.mp3", // オーボエ
            "wide_25-11_music_2-15h_orchestra_Fagot.mp3", // ファゴット
            "wide_25-11_music_2-15i_orchestra_Trumpet.mp3", // トランペット
            "wide_25-11_music_2-15j_orchestra_Trombone.mp3", // トロンボーン
            "wide_25-11_music_2-15k_orchestra_Horn.mp3", // ホルン
            "wide_25-11_music_2-15l_orchestra_Tuba.mp3"  // チューバ
        ];
        // --- ▲ 音源設定 ▲ ---


        // Audioオブジェクトのプール (最大12個同時再生)
        const audioPlayers = [];
        for (let i = 0; i < TRACK_URLS.length; i++) {
            audioPlayers.push(new Audio());
        }
        
        // DOM要素
        const buttonContainer = document.getElementById('button-container');
        const playButton = document.getElementById('play-button');
        const stopButton = document.getElementById('stop-button');
        const statusEl = document.getElementById('status');
        const template = document.getElementById('track-button-template');

        let selectedIndices = new Set(); // 選択中のトラック(インデックス)を保持
        let trackButtons = []; // ボタンの参照を保持する配列

        // --- 初期化 ---

        // トラックボタンを生成
        if (template && buttonContainer) {
            TRACK_URLS.forEach((url, index) => {
                const clone = template.content.cloneNode(true);
                const button = clone.querySelector('.track-button');
                
                // ★アイコン(画像)を設定★
                // 画像が見つからない時は名前の先頭4文字を表示するフォールバック処理を追加
                const altText = TRACK_NAMES[index] ? TRACK_NAMES[index].substring(0, 4) : '...';
                button.innerHTML = `<img src="${TRACK_ICONS[index]}" alt="${TRACK_NAMES[index]}" class="h-20 w-20 object-contain" onerror="this.style.display='none'; this.parentElement.innerHTML='${altText}'">`;
                
                button.dataset.index = index; 

                button.addEventListener('click', () => {
                    toggleTrackSelection(index);
                });

                buttonContainer.appendChild(clone);
                trackButtons.push(button); 
            });
        } else {
            console.error("初期化エラー: button-container または track-button-template が見つかりません。");
            statusEl.textContent = "ボタンの初期化に失敗しました";
        }


        // トラック選択処理 (トグル)
        function toggleTrackSelection(index) {
            // console.log(`Toggle track ${index}`);
            if (selectedIndices.has(index)) {
                selectedIndices.delete(index);
                trackButtons[index].classList.remove('selected');
            } else {
                selectedIndices.add(index);
                trackButtons[index].classList.add('selected');
            }
            updateStatusText();
        }

        // ステータステキスト更新
        function updateStatusText() {
            if (selectedIndices.size === 0) {
                statusEl.textContent = "がっき を えらんでください";
            } else {
                statusEl.textContent = `${selectedIndices.size}個 の がっき を選択中`;
            }
        }
        
        // --- 再生ロジック ---

        playButton.addEventListener('click', playSelected);
        stopButton.addEventListener('click', stopAllAudio);

        // 「さいせい」ボタン
        function playSelected() {
            stopAllAudio(false); // 停止（ステータスメッセージは更新しない）

            const selectedArray = Array.from(selectedIndices);
            if (selectedArray.length === 0) {
                statusEl.textContent = "さいせい する がっき を えらんでください";
                return;
            }

            // ★音量調整ロジック★
            // 選択数が多いほど音量を下げる (例: 1個=1.0, 5個=0.6, 12個=0.4)
            // 1/sqrt(N) に近いカーブで調整
            const volume = 1 / Math.sqrt(selectedArray.length);
            // console.log(`Playing ${selectedArray.length} tracks at volume ${volume}`);
            
            statusEl.textContent = `${selectedArray.length}個 の がっき を さいせい中...`;

            selectedArray.forEach(index => {
                const player = audioPlayers[index];
                const url = TRACK_URLS[index];
                const name = TRACK_NAMES[index];
                
                player.src = url;
                player.volume = volume; // 音量設定
                
                player.play().catch(e => {
                    console.error(`Playback error (${name}):`, e.message);
                    statusEl.textContent = `エラー (${name}): 読込失敗`;
                });
            });
        }

        // 「とめる」ボタン
        function stopAllAudio(updateStatus = true) {
            // console.log("Stopping all audio");
            audioPlayers.forEach(player => {
                player.pause();
                player.currentTime = 0;
            });
            if (updateStatus) {
                statusEl.textContent = "とめました";
            }
        }
        
        // 初期ステータスメッセージ
        updateStatusText();
    </script>
</body>
</html>
